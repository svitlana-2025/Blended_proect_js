{"version":3,"file":"cart.js","sources":["../src/cart.js"],"sourcesContent":["//Логіка сторінки C//Логіка сторінки Cart\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport { getProductById } from './js/products-api.js';\nimport { renderProducts, clearProducts } from './js/render-function.js';\nimport { refs } from './js/refs.js';\nimport {\n  onProductClick,\n  onModalActionsClick,\n  updateCounters,\n} from './js/handlers.js';\nimport { loadFromStorage, saveToStorage } from './js/storage.js';\nimport { STORAGE_KEYS } from './js/constants.js';\nimport {\n  handleScroll,\n  scrollToTop,\n  showLoader,\n  hideLoader,\n} from './js/helpers.js';\n\n/**\n * Оновлює блок \"Order Summary\" на сторінці кошика.\n */\nfunction updateCartSummary(itemsCount, total) {\n  // Ніяких змін тут не потрібно, оскільки refs.js тепер надає правильні посилання\n  if (refs.cartTotalItems) {\n    refs.cartTotalItems.textContent = itemsCount;\n  }\n  if (refs.cartTotalPrice) {\n    refs.cartTotalPrice.textContent = `$${total.toFixed(2)}`;\n  }\n}\n\n/**\n * Завантажує та відображає товари з кошика.\n */\nasync function loadCartProducts() {\n  showLoader();\n  const cartIds = loadFromStorage(STORAGE_KEYS.CART) || [];\n  clearProducts();\n\n  if (cartIds.length === 0) {\n    if (refs.productsList) {\n      refs.productsList.innerHTML =\n        '<li class=\"cart-empty-message\">Your cart is empty.</li>';\n    }\n    updateCartSummary(0, 0); // Оновлюємо суму, якщо кошик порожній\n    hideLoader();\n    return;\n  }\n\n  try {\n    const productPromises = cartIds.map(id => getProductById(id));\n    const products = await Promise.all(productPromises);\n    renderProducts(products);\n\n    const totalItems = products.length;\n    const totalPrice = products.reduce(\n      (sum, product) => sum + product.price,\n      0\n    );\n    updateCartSummary(totalItems, totalPrice); // Оновлюємо суму після завантаження товарів\n  } catch (error) {\n    iziToast.error({\n      title: 'Error',\n      message: 'Failed to load cart products.',\n    });\n    updateCartSummary(0, 0); // У разі помилки скидаємо суму\n  } finally {\n    hideLoader();\n  }\n}\n\n/**\n * Обробник для кнопки \"Купити\".\n */\nfunction onBuyBtnClick() {\n  const cartIds = loadFromStorage(STORAGE_KEYS.CART) || [];\n  if (cartIds.length > 0) {\n    iziToast.success({\n      title: 'Success',\n      message: 'Products purchased successfully!',\n      position: 'topRight',\n    });\n    saveToStorage(STORAGE_KEYS.CART, []);\n    loadCartProducts(); // Перезавантажуємо кошик (він стане порожнім)\n    updateCounters(); // Оновлюємо лічильник у хедері\n  } else {\n    iziToast.info({\n      title: 'Info',\n      message: 'Your cart is empty.',\n      position: 'topRight',\n    });\n  }\n}\n\n/**\n * Обробник кастомної події оновлення localStorage.\n * @param {CustomEvent} event\n */\nfunction handleStorageUpdate(event) {\n  // Перевіряємо, чи оновився саме кошик\n  if (event.detail.key === STORAGE_KEYS.CART) {\n    // Якщо так, перезавантажуємо список товарів на сторінці\n    loadCartProducts();\n  }\n}\n\n/**\n * Ініціалізація сторінки кошика.\n */\nfunction initializeCartPage() {\n  updateCounters();\n  loadCartProducts();\n\n  if (refs.productsList)\n    refs.productsList.addEventListener('click', onProductClick);\n  if (refs.modalActions)\n    refs.modalActions.addEventListener('click', onModalActionsClick);\n  if (refs.cartBuyBtn) refs.cartBuyBtn.addEventListener('click', onBuyBtnClick);\n  if (refs.scrollUpBtn) {\n    window.addEventListener('scroll', handleScroll);\n    refs.scrollUpBtn.addEventListener('click', scrollToTop);\n  }\n  // Встановлюємо слухача кастомної події storageUpdated\n  // для оновлення кошика при зміні localStorage\n  document.addEventListener('storageUpdated', handleStorageUpdate);\n}\n\ndocument.addEventListener('DOMContentLoaded', initializeCartPage);art\n"],"names":["updateCartSummary","itemsCount","total","refs","loadCartProducts","showLoader","cartIds","loadFromStorage","STORAGE_KEYS","clearProducts","hideLoader","productPromises","id","getProductById","products","renderProducts","totalItems","totalPrice","sum","product","iziToast","onBuyBtnClick","saveToStorage","updateCounters","handleStorageUpdate","event","initializeCartPage","onProductClick","onModalActionsClick","handleScroll","scrollToTop"],"mappings":"mLAuBA,SAASA,EAAkBC,EAAYC,EAAO,CAExCC,EAAK,iBACPA,EAAK,eAAe,YAAcF,GAEhCE,EAAK,iBACPA,EAAK,eAAe,YAAc,IAAID,EAAM,QAAQ,CAAC,CAAC,GAE1D,CAKA,eAAeE,GAAmB,CAChCC,IACA,MAAMC,EAAUC,EAAgBC,EAAa,IAAI,GAAK,CAAA,EAGtD,GAFAC,IAEIH,EAAQ,SAAW,EAAG,CACpBH,EAAK,eACPA,EAAK,aAAa,UAChB,2DAEJH,EAAkB,EAAG,CAAC,EACtBU,IACA,MACD,CAED,GAAI,CACF,MAAMC,EAAkBL,EAAQ,IAAIM,GAAMC,EAAeD,CAAE,CAAC,EACtDE,EAAW,MAAM,QAAQ,IAAIH,CAAe,EAClDI,EAAeD,CAAQ,EAEvB,MAAME,EAAaF,EAAS,OACtBG,EAAaH,EAAS,OAC1B,CAACI,EAAKC,IAAYD,EAAMC,EAAQ,MAChC,CACN,EACInB,EAAkBgB,EAAYC,CAAU,CACzC,MAAe,CACdG,EAAS,MAAM,CACb,MAAO,QACP,QAAS,+BACf,CAAK,EACDpB,EAAkB,EAAG,CAAC,CAC1B,QAAY,CACRU,GACD,CACH,CAKA,SAASW,GAAgB,EACPd,EAAgBC,EAAa,IAAI,GAAK,CAAA,GAC1C,OAAS,GACnBY,EAAS,QAAQ,CACf,MAAO,UACP,QAAS,mCACT,SAAU,UAChB,CAAK,EACDE,EAAcd,EAAa,KAAM,CAAA,CAAE,EACnCJ,IACAmB,KAEAH,EAAS,KAAK,CACZ,MAAO,OACP,QAAS,sBACT,SAAU,UAChB,CAAK,CAEL,CAMA,SAASI,EAAoBC,EAAO,CAE9BA,EAAM,OAAO,MAAQjB,EAAa,MAEpCJ,GAEJ,CAKA,SAASsB,GAAqB,CAC5BH,IACAnB,IAEID,EAAK,cACPA,EAAK,aAAa,iBAAiB,QAASwB,CAAc,EACxDxB,EAAK,cACPA,EAAK,aAAa,iBAAiB,QAASyB,CAAmB,EAC7DzB,EAAK,YAAYA,EAAK,WAAW,iBAAiB,QAASkB,CAAa,EACxElB,EAAK,cACP,OAAO,iBAAiB,SAAU0B,CAAY,EAC9C1B,EAAK,YAAY,iBAAiB,QAAS2B,CAAW,GAIxD,SAAS,iBAAiB,iBAAkBN,CAAmB,CACjE,CAEA,SAAS,iBAAiB,mBAAoBE,CAAkB,EAAE"}